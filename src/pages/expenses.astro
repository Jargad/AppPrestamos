---
import MenuButton from "../components/MenuButton.astro";
import NavigationMenu from "../components/NavigationMenu.astro";
import ExpenseForm from "../components/ExpenseForm.astro";
import "../styles/global.css";

// Check authentication
const sessionCookie = Astro.cookies.get("session");
if (!sessionCookie) {
    return Astro.redirect("/auth");
}

let session;
try {
    session = JSON.parse(sessionCookie.value);
} catch {
    return Astro.redirect("/auth");
}
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        <meta
            name="description"
            content="Gestiona tus gastos mensuales y anuales"
        />
        <title>Gastos - Gestor de Pr√©stamos</title>
    </head>
    <body>
        <NavigationMenu />
        <div class="container">
            <header class="main-header">
                <div class="header-user-section">
                    <MenuButton />
                    <span id="user-info" class="user-info">
                        üë§ {session.username}
                    </span>
                </div>
                <div class="header-content">
                    <h1 class="header-title">üìä Gesti√≥n de Gastos</h1>
                    <p class="header-subtitle">
                        Registra y controla tus gastos mensuales y anuales
                    </p>
                </div>
            </header>

            <!-- Statistics Section -->
            <div class="grid grid-2" style="margin-bottom: 3rem;">
                <div
                    class="card"
                    style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(96, 165, 250, 0.1)); border-color: rgba(139, 92, 246, 0.3);"
                >
                    <h3 style="margin-bottom: 1rem; font-size: 1.25rem;">
                        üìà Estad√≠sticas
                    </h3>
                    <div id="stats" style="display: grid; gap: 1rem;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center;"
                        >
                            <span style="color: var(--text-secondary);"
                                >Total Gastos del Mes:</span
                            >
                            <strong
                                id="monthly-total"
                                style="font-size: 1.5rem; background: linear-gradient(135deg, hsl(260, 85%, 65%), hsl(200, 90%, 60%)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
                                >$0</strong
                            >
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center;"
                        >
                            <span style="color: var(--text-secondary);"
                                >Total Gastos del A√±o:</span
                            >
                            <strong
                                id="annual-total"
                                style="font-size: 1.5rem; background: linear-gradient(135deg, hsl(355, 75%, 60%), hsl(40, 95%, 60%)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
                                >$0</strong
                            >
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center;"
                        >
                            <span style="color: var(--text-secondary);"
                                >Cantidad de Gastos:</span
                            >
                            <strong
                                id="expense-count"
                                style="font-size: 1.5rem;">0</strong
                            >
                        </div>
                    </div>
                </div>

                <ExpenseForm />
            </div>

            <!-- Filter Section -->
            <div class="card" style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; font-size: 1.25rem;">
                    üîç Filtrar Gastos
                </h3>
                <div class="grid grid-2">
                    <div class="input-group" style="margin-bottom: 0;">
                        <label for="filter-year">A√±o</label>
                        <select id="filter-year">
                            <option value="">Todos los a√±os</option>
                        </select>
                    </div>
                    <div class="input-group" style="margin-bottom: 0;">
                        <label for="filter-month">Mes</label>
                        <select id="filter-month">
                            <option value="">Todos los meses</option>
                            <option value="01">Enero</option>
                            <option value="02">Febrero</option>
                            <option value="03">Marzo</option>
                            <option value="04">Abril</option>
                            <option value="05">Mayo</option>
                            <option value="06">Junio</option>
                            <option value="07">Julio</option>
                            <option value="08">Agosto</option>
                            <option value="09">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Recurring Expenses Section -->
            <div class="expenses-section" style="margin-bottom: 3rem;">
                <h2
                    style="margin-bottom: 1.5rem; font-size: 1.75rem; background: linear-gradient(135deg, hsl(260, 85%, 65%), hsl(200, 90%, 60%)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
                >
                    üîÑ Gastos Recurrentes
                </h2>
                <div
                    id="recurring-expenses-table-container"
                    style="overflow-x: auto;"
                >
                    <table
                        id="recurring-expenses-table"
                        class="expenses-table"
                        style="display: none;"
                    >
                        <thead>
                            <tr>
                                <th>Descripci√≥n</th>
                                <th>D√≠a</th>
                                <th>Categor√≠a</th>
                                <th>Monto</th>
                                <th style="text-align: center;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="recurring-expenses-list"> </tbody>
                    </table>
                </div>
                <div
                    id="recurring-empty-state"
                    style="text-align: center; padding: 2rem; color: var(--text-tertiary); display: none; background: var(--bg-tertiary); border-radius: var(--border-radius); border: 1px dashed var(--border-color);"
                >
                    <p style="font-size: 1rem; margin-bottom: 0.5rem;">
                        üìÖ No hay gastos recurrentes
                    </p>
                    <p style="font-size: 0.9rem;">
                        Marca un gasto como recurrente para verlo aqu√≠
                    </p>
                </div>
            </div>

            <!-- One-time Expenses List -->
            <div class="expenses-section">
                <h2
                    style="margin-bottom: 1.5rem; font-size: 1.75rem; background: linear-gradient(135deg, hsl(260, 85%, 65%), hsl(200, 90%, 60%)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
                >
                    üí∞ Gastos √önicos
                </h2>
                <div id="expenses-table-container" style="overflow-x: auto;">
                    <table
                        id="expenses-table"
                        class="expenses-table"
                        style="display: none;"
                    >
                        <thead>
                            <tr>
                                <th>Descripci√≥n</th>
                                <th>Categor√≠a</th>
                                <th>Monto</th>
                                <th>Fecha</th>
                                <th style="text-align: center;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="expenses-list"> </tbody>
                    </table>
                </div>
                <div
                    id="empty-state"
                    style="text-align: center; padding: 3rem; color: var(--text-tertiary); display: none;"
                >
                    <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">
                        üì≠ No hay gastos registrados
                    </p>
                    <p>Agrega tu primer gasto usando el formulario de arriba</p>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div id="edit-modal" class="modal-overlay" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h2>‚úèÔ∏è Editar Gasto</h2>
                    <button id="close-modal-btn" class="close-btn">‚úï</button>
                </div>
                <form id="edit-expense-form">
                    <input type="hidden" id="edit-expense-id" />

                    <div class="input-group">
                        <label for="edit-description">Descripci√≥n</label>
                        <input
                            type="text"
                            id="edit-description"
                            required
                            placeholder="Descripci√≥n del gasto"
                        />
                    </div>

                    <div class="grid grid-2">
                        <div class="input-group">
                            <label for="edit-amount">Monto</label>
                            <input
                                type="number"
                                id="edit-amount"
                                required
                                min="0"
                                step="0.01"
                            />
                        </div>

                        <div class="input-group">
                            <label for="edit-category">Categor√≠a</label>
                            <select id="edit-category" required>
                                <option value="Vivienda">üè† Vivienda</option>
                                <option value="Transporte">üöó Transporte</option
                                >
                                <option value="Alimentaci√≥n"
                                    >üçî Alimentaci√≥n</option
                                >
                                <option value="Servicios">üí° Servicios</option>
                                <option value="Entretenimiento"
                                    >üéÆ Entretenimiento</option
                                >
                                <option value="Salud">‚öïÔ∏è Salud</option>
                                <option value="Educaci√≥n">üìö Educaci√≥n</option>
                                <option value="Otros">üì¶ Otros</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="edit-date">Fecha</label>
                        <input type="date" id="edit-date" required />
                    </div>

                    <div class="input-group" style="margin-bottom: 1rem;">
                        <label
                            style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;"
                        >
                            <input
                                type="checkbox"
                                id="edit-recurring"
                                style="width: auto; cursor: pointer;"
                            />
                            <span>üîÑ Gasto Recurrente/Suscripci√≥n</span>
                        </label>
                    </div>

                    <div
                        id="edit-recurrence-day-field"
                        class="input-group"
                        style="display: none;"
                    >
                        <label for="edit-recurrence-day"
                            >D√≠a del Mes (1-31)</label
                        >
                        <input
                            type="number"
                            id="edit-recurrence-day"
                            min="1"
                            max="31"
                        />
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button
                            type="submit"
                            class="btn btn-primary"
                            style="flex: 1;"
                        >
                            üíæ Guardar Cambios
                        </button>
                        <button
                            type="button"
                            id="cancel-edit-btn"
                            class="btn btn-secondary"
                            style="flex: 1;"
                        >
                            ‚ùå Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </body>
</html>

<script>
    // Format currency
    function formatCurrency(amount: number): string {
        return new Intl.NumberFormat("es-CO", {
            style: "currency",
            currency: "COP",
            minimumFractionDigits: 0,
        }).format(amount);
    }

    // Format date
    function formatDate(dateString: string): string {
        return new Intl.DateTimeFormat("es-CO", {
            year: "numeric",
            month: "long",
            day: "numeric",
        }).format(new Date(dateString));
    }

    // Get category icon
    function getCategoryIcon(category: string): string {
        const icons: Record<string, string> = {
            Vivienda: "üè†",
            Transporte: "üöó",
            Alimentaci√≥n: "üçî",
            Servicios: "üí°",
            Entretenimiento: "üéÆ",
            Salud: "‚öïÔ∏è",
            Educaci√≥n: "üìö",
            Otros: "üì¶",
        };
        return icons[category] || "üì¶";
    }

    // Load expenses
    async function loadExpenses() {
        try {
            const yearFilter = (
                document.getElementById("filter-year") as HTMLSelectElement
            )?.value;
            const monthFilter = (
                document.getElementById("filter-month") as HTMLSelectElement
            )?.value;

            let url = "/api/expenses";
            const params = new URLSearchParams();
            if (yearFilter) params.append("year", yearFilter);
            if (monthFilter) params.append("month", monthFilter);
            if (params.toString()) url += `?${params.toString()}`;

            const response = await fetch(url);

            const data = await response.json();

            if (data.success) {
                renderExpenses(data.expenses || []);
                updateStats(data.expenses || []);
            }
        } catch (error) {
            console.error("Error loading expenses:", error);
        }
    }

    // Render expenses
    function renderExpenses(expenses: any[]) {
        const recurringList = document.getElementById(
            "recurring-expenses-list",
        );
        const oneTimeList = document.getElementById("expenses-list");
        const recurringEmptyState = document.getElementById(
            "recurring-empty-state",
        );
        const oneTimeEmptyState = document.getElementById("empty-state");

        if (
            !recurringList ||
            !oneTimeList ||
            !recurringEmptyState ||
            !oneTimeEmptyState
        )
            return;

        // Separate recurring and one-time expenses
        const recurringExpenses = expenses.filter((e) => e.is_recurring === 1);
        const oneTimeExpenses = expenses.filter((e) => e.is_recurring === 0);

        // Render recurring expenses
        const recurringTable = document.getElementById(
            "recurring-expenses-table",
        );
        if (recurringExpenses.length === 0) {
            if (recurringTable) recurringTable.style.display = "none";
            recurringEmptyState.style.display = "block";
        } else {
            if (recurringTable) recurringTable.style.display = "table";
            recurringEmptyState.style.display = "none";

            recurringList.innerHTML = recurringExpenses
                .map((expense) => {
                    return `
								<tr class="expense-row recurring-expense">
									<td style="padding-left: 10px;">
										<div class="expense-description">
											<span class="expense-icon">${getCategoryIcon(expense.category)}</span>
											<span>${expense.description}</span>
										</div>
									</td>
									<td class="expense-recurrence">${Number(expense.recurrence_day)}</td>
									<td>
										<span class="expense-category badge badge-recurring">${expense.category}</span>
									</td>
									<td class="expense-amount">${formatCurrency(expense.amount)}</td>
									<td class="expense-actions" style="text-align: center;">
										<button class="btn btn-sm btn-primary edit-expense-btn" data-id="${expense.id}" title="Editar">
											‚úèÔ∏è
										</button>
										<button class="btn btn-sm btn-danger delete-expense-btn" data-id="${expense.id}" title="Eliminar">
											üóëÔ∏è
										</button>
									</td>
								</tr>
							`;
                })
                .join("");
        }

        // Render one-time expenses
        const oneTimeTable = document.getElementById("expenses-table");
        if (oneTimeExpenses.length === 0) {
            if (oneTimeTable) oneTimeTable.style.display = "none";
            oneTimeEmptyState.style.display = "block";
        } else {
            if (oneTimeTable) oneTimeTable.style.display = "table";
            oneTimeEmptyState.style.display = "none";

            oneTimeList.innerHTML = oneTimeExpenses
                .map((expense) => {
                    return `
								<tr class="expense-row">
									<td style="padding-left: 10px;">
										<div class="expense-description">
											<span class="expense-icon">${getCategoryIcon(expense.category)}</span>
											<span>${expense.description}</span>
										</div>
									</td>
									<td>
										<span class="expense-category badge">${expense.category}</span>
									</td>
									<td class="expense-amount">${formatCurrency(expense.amount)}</td>
									<td class="expense-date">${formatDate(expense.expense_date)}</td>
									<td class="expense-actions" style="text-align: center;">
										<button class="btn btn-sm btn-primary edit-expense-btn" data-id="${expense.id}" title="Editar">
											‚úèÔ∏è
										</button>
										<button class="btn btn-sm btn-danger delete-expense-btn" data-id="${expense.id}" title="Eliminar">
											üóëÔ∏è
										</button>
									</td>
								</tr>
							`;
                })
                .join("");
        }

        // Attach event handlers
        attachExpenseHandlers(expenses);
    }

    // Attach event handlers to expense buttons
    function attachExpenseHandlers(expenses: any[]) {
        // Delete handlers
        document.querySelectorAll(".delete-expense-btn").forEach((btn) => {
            btn.addEventListener("click", async () => {
                const expenseId = (btn as HTMLElement).dataset.id;
                if (
                    expenseId &&
                    confirm("¬øEst√°s seguro de eliminar este gasto?")
                ) {
                    await deleteExpense(expenseId);
                }
            });
        });

        // Edit handlers
        document.querySelectorAll(".edit-expense-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
                const expenseId = (btn as HTMLElement).dataset.id;
                const expense = expenses.find((e) => e.id === expenseId);
                if (expense) {
                    openEditModal(expense);
                }
            });
        });
    }

    // Delete expense
    async function deleteExpense(expenseId: string) {
        try {
            const response = await fetch(`/api/expenses/${expenseId}`, {
                method: "DELETE",
            });
            const data = await response.json();
            if (data.success) {
                loadExpenses();
            } else {
                alert(data.error || "Error al eliminar gasto");
            }
        } catch (error) {
            alert("Error de conexi√≥n");
        }
    }

    // Open edit modal
    function openEditModal(expense: any) {
        const modal = document.getElementById("edit-modal");
        const editRecurringCheckbox = document.getElementById(
            "edit-recurring",
        ) as HTMLInputElement;
        const editRecurrenceDayField = document.getElementById(
            "edit-recurrence-day-field",
        );
        const editRecurrenceDayInput = document.getElementById(
            "edit-recurrence-day",
        ) as HTMLInputElement;

        if (!modal) return;

        // Populate form
        (document.getElementById("edit-expense-id") as HTMLInputElement).value =
            expense.id;
        (
            document.getElementById("edit-description") as HTMLInputElement
        ).value = expense.description;
        (document.getElementById("edit-amount") as HTMLInputElement).value =
            expense.amount;
        (document.getElementById("edit-category") as HTMLSelectElement).value =
            expense.category;
        (document.getElementById("edit-date") as HTMLInputElement).value =
            expense.expense_date;

        editRecurringCheckbox.checked = expense.is_recurring === 1;
        if (expense.is_recurring === 1 && expense.recurrence_day) {
            editRecurrenceDayInput.value = expense.recurrence_day;
            if (editRecurrenceDayField) {
                editRecurrenceDayField.style.display = "block";
            }
        } else {
            if (editRecurrenceDayField) {
                editRecurrenceDayField.style.display = "none";
            }
        }

        modal.style.display = "flex";
    }

    // Close edit modal
    function closeEditModal() {
        const modal = document.getElementById("edit-modal");
        if (modal) {
            modal.style.display = "none";
        }
    }

    // Update expense
    async function updateExpense(expenseId: string, updates: any) {
        try {
            const response = await fetch(`/api/expenses/${expenseId}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(updates),
            });
            const data = await response.json();
            if (data.success) {
                closeEditModal();
                loadExpenses();
            } else {
                alert(data.error || "Error al actualizar gasto");
            }
        } catch (error) {
            alert("Error de conexi√≥n");
        }
    }

    // Update statistics
    function updateStats(expenses: any[]) {
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth() + 1;

        // Calculate monthly total (one-time expenses for current month)
        const monthlyExpenses = expenses.filter((e) => {
            if (e.is_recurring === 1) return false;
            const date = new Date(e.expense_date);
            return (
                date.getFullYear() === currentYear &&
                date.getMonth() + 1 === currentMonth
            );
        });
        const monthlyOneTimeTotal = monthlyExpenses.reduce(
            (sum, e) => sum + e.amount,
            0,
        );

        // Calculate recurring monthly total
        const recurringExpenses = expenses.filter((e) => e.is_recurring === 1);
        const recurringMonthlyTotal = recurringExpenses.reduce(
            (sum, e) => sum + e.amount,
            0,
        );

        // Total monthly = one-time + recurring
        const monthlyTotal = monthlyOneTimeTotal + recurringMonthlyTotal;

        // Calculate annual total
        const annualExpenses = expenses.filter((e) => {
            if (e.is_recurring === 1) return false;
            const date = new Date(e.expense_date);
            return date.getFullYear() === currentYear;
        });
        const annualOneTimeTotal = annualExpenses.reduce(
            (sum, e) => sum + e.amount,
            0,
        );
        // Annual total = one-time expenses + (recurring * 12)
        const annualTotal = annualOneTimeTotal + recurringMonthlyTotal * 12;

        // Update UI
        const monthlyTotalEl = document.getElementById("monthly-total");
        const annualTotalEl = document.getElementById("annual-total");
        const expenseCountEl = document.getElementById("expense-count");

        if (monthlyTotalEl)
            monthlyTotalEl.textContent = formatCurrency(monthlyTotal);
        if (annualTotalEl)
            annualTotalEl.textContent = formatCurrency(annualTotal);
        if (expenseCountEl)
            expenseCountEl.textContent = expenses.length.toString();
    }

    // Populate year filter
    function populateYearFilter() {
        const yearSelect = document.getElementById(
            "filter-year",
        ) as HTMLSelectElement;
        if (!yearSelect) return;

        const currentYear = new Date().getFullYear();
        for (let year = currentYear; year >= currentYear - 10; year--) {
            const option = document.createElement("option");
            option.value = year.toString();
            option.textContent = year.toString();
            if (year === currentYear) option.selected = true;
            yearSelect.appendChild(option);
        }
    }

    // Listen for expense created event
    window.addEventListener("expense-created", () => {
        loadExpenses();
    });

    // Listen for filter changes
    document
        .getElementById("filter-year")
        ?.addEventListener("change", loadExpenses);
    document
        .getElementById("filter-month")
        ?.addEventListener("change", loadExpenses);

    // Edit modal event listeners
    const editModal = document.getElementById("edit-modal");
    const closeModalBtn = document.getElementById("close-modal-btn");
    const cancelEditBtn = document.getElementById("cancel-edit-btn");
    const editExpenseForm = document.getElementById(
        "edit-expense-form",
    ) as HTMLFormElement;
    const editRecurringCheckbox = document.getElementById(
        "edit-recurring",
    ) as HTMLInputElement;
    const editRecurrenceDayField = document.getElementById(
        "edit-recurrence-day-field",
    );
    const editRecurrenceDayInput = document.getElementById(
        "edit-recurrence-day",
    ) as HTMLInputElement;

    // Close modal on close button
    closeModalBtn?.addEventListener("click", closeEditModal);
    cancelEditBtn?.addEventListener("click", closeEditModal);

    // Close modal on overlay click
    editModal?.addEventListener("click", (e) => {
        if (e.target === editModal) {
            closeEditModal();
        }
    });

    // Toggle recurrence day field in edit modal
    editRecurringCheckbox?.addEventListener("change", () => {
        if (editRecurrenceDayField) {
            editRecurrenceDayField.style.display = editRecurringCheckbox.checked
                ? "block"
                : "none";
            if (editRecurringCheckbox.checked) {
                editRecurrenceDayInput.required = true;
            } else {
                editRecurrenceDayInput.required = false;
                editRecurrenceDayInput.value = "";
            }
        }
    });

    // Handle edit form submission
    editExpenseForm?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const expenseId = (
            document.getElementById("edit-expense-id") as HTMLInputElement
        ).value;
        const updates: any = {
            description: (
                document.getElementById("edit-description") as HTMLInputElement
            ).value,
            amount: (document.getElementById("edit-amount") as HTMLInputElement)
                .value,
            category: (
                document.getElementById("edit-category") as HTMLSelectElement
            ).value,
            expenseDate: (
                document.getElementById("edit-date") as HTMLInputElement
            ).value,
            isRecurring: editRecurringCheckbox.checked,
        };

        if (editRecurringCheckbox.checked) {
            updates.recurrenceDay = editRecurrenceDayInput.value;
        }

        await updateExpense(expenseId, updates);
    });

    // Initial load
    populateYearFilter();
    loadExpenses();
</script>

<style>
    /* Header Styles */
    .main-header {
        text-align: center;
        margin-bottom: 3rem;
        position: relative;
    }

    .header-user-section {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .user-info {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .logout-btn {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
    }

    .header-content {
        margin-top: 1rem;
    }

    .header-title {
        font-size: 3rem;
        margin-bottom: 0.5rem;
        background: linear-gradient(
            135deg,
            hsl(260, 85%, 65%),
            hsl(200, 90%, 60%)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .header-subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    /* Expenses Table */
    .expenses-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--bg-secondary);
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        animation: slideUp 0.3s ease;
    }

    .expenses-table thead {
        background: linear-gradient(
            135deg,
            rgba(139, 92, 246, 0.15),
            rgba(96, 165, 250, 0.15)
        );
        border-bottom: 2px solid rgba(139, 92, 246, 0.3);
    }

    .expenses-table th {
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .expenses-table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-secondary);
    }

    .expense-row:last-child td {
        border-bottom: none;
    }

    .expense-row:hover {
        background: var(--bg-hover);
        transition: background 0.2s ease;
    }

    .expense-row.recurring-expense {
        background: rgba(52, 211, 153, 0.05);
    }

    .expense-row.recurring-expense:hover {
        background: rgba(52, 211, 153, 0.1);
    }

    .expense-description {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
        color: var(--text-primary);
    }

    .expense-icon {
        font-size: 1.2rem;
    }

    .expense-category {
        background: rgba(139, 92, 246, 0.15);
        color: var(--color-primary);
        border: 1px solid rgba(139, 92, 246, 0.3);
        white-space: nowrap;
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        display: inline-block;
    }

    .badge-recurring {
        background: rgba(52, 211, 153, 0.15);
        color: var(--color-success);
        border: 1px solid rgba(52, 211, 153, 0.3);
    }

    .expense-amount {
        font-size: 1.1rem;
        font-weight: 700;
        background: linear-gradient(
            135deg,
            hsl(260, 85%, 65%),
            hsl(200, 90%, 60%)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        white-space: nowrap;
    }

    .expense-date {
        color: var(--text-tertiary);
        font-size: 0.9rem;
    }

    .expense-recurrence {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .expense-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
    }

    .btn-sm {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
        min-width: auto;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
        .header-user-section {
            flex-direction: column;
            align-items: stretch;
            gap: 0.5rem;
        }

        .user-info {
            text-align: center;
            font-size: 0.85rem;
        }

        .logout-btn {
            width: 100%;
        }

        .header-title {
            font-size: 2rem;
        }

        .header-subtitle {
            font-size: 0.95rem;
        }

        /* Mobile table optimizations */
        .expenses-table {
            font-size: 0.75rem;
        }

        .expenses-table th,
        .expenses-table td {
            padding: 0.5rem 0.3rem;
        }

        .expenses-table th {
            font-size: 0.7rem;
            padding: 0.6rem 0.3rem;
        }

        .expense-description {
            font-size: 0.8rem;
        }

        .expense-icon {
            font-size: 1rem;
        }

        .expense-category {
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
        }

        .expense-amount {
            font-size: 0.9rem;
        }

        .expense-date,
        .expense-recurrence {
            font-size: 0.75rem;
        }

        .expense-actions {
            flex-direction: row;
            gap: 0.25rem;
            justify-content: center;
        }

        :global(.expense-actions .btn.btn-sm) {
            padding: 0.35rem !important;
            font-size: 1rem !important;
            min-width: auto !important;
            width: auto !important;
            aspect-ratio: 1;
            display: inline-flex !important;
            align-items: center;
            justify-content: center;
            gap: 0 !important;
            transform: scale(0.85);
        }
    }

    @media (max-width: 480px) {
        .header-title {
            font-size: 1.75rem;
        }

        .header-subtitle {
            font-size: 0.9rem;
        }

        /* Extra small screens - even more compact */
        .expenses-table {
            font-size: 0.7rem;
        }

        .expenses-table th,
        .expenses-table td {
            padding: 0.4rem 0.2rem;
        }

        .expenses-table th {
            font-size: 0.65rem;
            padding: 0.5rem 0.2rem;
        }

        .expense-description {
            font-size: 0.75rem;
            gap: 0.3rem;
        }

        .expense-icon {
            font-size: 0.9rem;
        }

        .expense-category {
            font-size: 0.6rem;
            padding: 0.15rem 0.3rem;
        }

        .expense-amount {
            font-size: 0.85rem;
        }

        .expense-date,
        .expense-recurrence {
            font-size: 0.7rem;
        }

        :global(.expense-actions .btn.btn-sm) {
            padding: 0.3rem !important;
            font-size: 0.95rem !important;
            min-width: auto !important;
            width: auto !important;
            aspect-ratio: 1;
            display: inline-flex !important;
            align-items: center;
            justify-content: center;
            gap: 0 !important;
            transform: scale(0.85);
        }
    }
</style>
